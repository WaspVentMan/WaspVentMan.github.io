<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>json-practice</title>
    <link rel="shortcut icon" href="https://waspventman.co.uk/img/wasp.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <label for="con"><i>continent:</i></label><br>
    <input type="text" id="con" name="con" value=""> <br>
    <label for="city"><i>city:</i></label><br>
    <input type="text" id="city" name="city" value=""><br><br>
    <button id="submit" onClick="displayDate()">submit</button>

    <h1 class="title"></h1>
    <h2 class="date"></h2>
    <h3 class="time"></h3>
</body>
<script>
    function UrlExists(url) {
        var http = new XMLHttpRequest();
        http.open('HEAD', url, false);
        http.send();
        if (http.status != 404)
            return true;
        else
            return false;
    }

    //{"abbreviation":"BST","client_ip":"193.108.244.42","datetime":"2023-09-26T10:25:08.698157+01:00","day_of_week":2,"day_of_year":269,"dst":true,"dst_from":"2023-03-26T01:00:00+00:00","dst_offset":3600,"dst_until":"2023-10-29T01:00:00+00:00","raw_offset":0,"timezone":"Europe/London","unixtime":1695720308,"utc_datetime":"2023-09-26T09:25:08.698157+00:00","utc_offset":"+01:00","week_number":39}

    // Using async here since we are dealing with timing out of our control.
    // we can use await to pause execution of this function until a specific 
    // condition has been met (in this scenario, we are waiting for an API 
    // response)
    async function displayDate() {
        
        //Assign variables to elements, this means we wont need to call the long functions again
        let continent = document.getElementById("con").value
        let city = document.getElementById("city").value

        if(city == "" || continent == ""){
            document.querySelector('.title').textContent = 'Sorry, there was an error.'
            document.querySelector('.date').textContent = 'The city and/or continent cannot be left blank.'
            document.querySelector('.time').textContent = ':)'
            return
        }

        // Build the api call using the inputs
        let url = "https://worldtimeapi.org/api/timezone/" + continent + "/" + city

        // Make the API call and recieve a promise that "something" will arrive soon
        if(UrlExists(url)) {
            const time = fetch(url).then((response) => { return response.json(); console.log(response) })
        

            // Wait for the response from the API call then once it responds, set the contents of 
            // para to the result
            const printTime = async () => {
                let a = await time;
                let date = a.datetime.split("T")[0].split("-")
                let timePlusPlus =  a.datetime.split("T")[1].split(".")[0]
                date = "Date: " + date[2] + "/" + date[1] + "/" + date[0]
                document.querySelector(".title").textContent = "The time and date in " + city + ", " + continent + " is..."
                document.querySelector(".date").textContent = date
                document.querySelector(".time").textContent = "Time: " + timePlusPlus
            }
            printTime()
        } else {
            document.querySelector('.title').textContent = 'Sorry, there was an error.'
            document.querySelector('.date').textContent = 'It\'s your fault by the way.'
            document.querySelector('.time').textContent = ':)'
            return
        }
        
    }

</script>

</html>